{"version":3,"file":"ng-inactivity-timer.umd.js.map","sources":["ng://ng-inactivity-timer/lib/activity-monitor.token.ts","ng://ng-inactivity-timer/lib/inactivity-config.token.ts","ng://ng-inactivity-timer/lib/inactivity-timer.service.ts"],"sourcesContent":["import { InjectionToken } from '@angular/core';\nimport { ActivityMonitor } from './activity-monitor.interface';\n\nexport const ACTIVITY_MONITOR = new InjectionToken<ActivityMonitor>(\n  'Activity Monitor'\n);\n","import { InjectionToken } from '@angular/core';\nimport { InactivityConfig } from './inactivity-config.interface';\n\nexport const INACTIVITY_CONFIG = new InjectionToken<InactivityConfig>(\n  'Inactivity Configuration'\n);\n","import {\n  interval as observableInterval,\n  BehaviorSubject,\n  Observable,\n  Subject,\n  of,\n  timer,\n  merge\n} from 'rxjs';\nimport { ActivityMonitor } from './activity-monitor.interface';\nimport { ACTIVITY_MONITOR } from './activity-monitor.token';\nimport { InactivityConfig } from './inactivity-config.interface';\nimport { INACTIVITY_CONFIG } from './inactivity-config.token';\nimport { Inject, Injectable, Optional } from '@angular/core';\nimport {\n  switchMap,\n  throttle,\n  map,\n  startWith,\n  filter,\n  takeUntil\n} from 'rxjs/operators';\n\n@Injectable({\n  providedIn: 'root',\n  deps: [INACTIVITY_CONFIG, ACTIVITY_MONITOR]\n})\nexport class InactivityTimerService {\n  private timeout$: Observable<Date | never>;\n  private monitor$ = new BehaviorSubject<boolean>(true);\n  private artificialActivity$ = new Subject<void>();\n\n  constructor(\n    @Inject(INACTIVITY_CONFIG) private config: InactivityConfig,\n    @Optional()\n    @Inject(ACTIVITY_MONITOR)\n    private monitor: ActivityMonitor\n  ) {\n    // Merge all monitors together, and activate them via register()\n    this.timeout$ = this.monitor$.pipe(\n      filter(x => !!x),\n      switchMap(m => {\n        return merge(this.monitor.getMonitor(), this.artificialActivity$).pipe(\n          throttle(() => observableInterval(500)), // Throttle - to stop spamming\n          startWith(undefined), // Trigger observable immediately\n          map(() => {\n            const d = new Date();\n            d.setMinutes(d.getMinutes() + config.inactivityTime);\n            return d;\n          }),\n          takeUntil(this.monitor$.pipe(filter(x => !x)))\n        );\n      })\n    );\n  }\n\n  /**\n   * Emits Timeout objects describing current timeout state\n   * @returns Observable<Timeout>\n   */\n  public getTimeOut(): Observable<Timeout> {\n    return this.timeout$.pipe(\n      switchMap((date: Date) => {\n        return timer(0, 60000).pipe(\n          switchMap(() => {\n            const f = new Date();\n            return of({\n              showWarning: this.config.warningTime\n                ? f.getTime() + this.config.warningTime > date.getTime()\n                : false,\n              timedOut: f.getTime() > date.getTime(),\n              timeLeft: date.getTime() - f.getTime()\n            });\n          })\n        );\n      })\n    );\n  }\n\n  /**\n   * Starts listening for activity.\n   * @param activate=false. If true will reset the activity timer as any other activity.\n   * @returns void\n   */\n  public startMonitor(activate = false): void {\n    this.monitor$.next(true);\n    if (activate) {\n      this.activate();\n    }\n  }\n\n  /**\n   * Stops listening for activity.\n   * @returns void\n   */\n  public stopMonitor(): void {\n    this.monitor$.next(false);\n  }\n\n  /**\n   * Provides a programmatic way of simulating activity.\n   * Will reset the activity timer as any other activity.\n   */\n  public activate(): void {\n    this.artificialActivity$.next(undefined);\n  }\n}\n\nexport interface Timeout {\n  showWarning: boolean;\n  timedOut: boolean;\n  timeLeft: number;\n}\n"],"names":["InjectionToken","BehaviorSubject","Subject","filter","switchMap","merge","throttle","observableInterval","startWith","map","takeUntil","timer","of","Injectable","Inject","Optional"],"mappings":"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"}
